#!/bin/bash
# make sure there is no preexisting Docker CID file
rm -f /Users/magdalenasevilla/plink2-workflow/cromwell-executions/run_plink2/f4b3c5ff-a170-48ad-9beb-187e88d73914/call-process_phenos/execution/docker_cid
# run as in the original configuration without --rm flag (will remove later)
docker run \
  --cidfile /Users/magdalenasevilla/plink2-workflow/cromwell-executions/run_plink2/f4b3c5ff-a170-48ad-9beb-187e88d73914/call-process_phenos/execution/docker_cid \
  -i \
   \
  --entrypoint /bin/bash \
  -v /Users/magdalenasevilla/plink2-workflow/cromwell-executions/run_plink2/f4b3c5ff-a170-48ad-9beb-187e88d73914/call-process_phenos:/cromwell-executions/run_plink2/f4b3c5ff-a170-48ad-9beb-187e88d73914/call-process_phenos:delegated \
  quay.io/large-scale-gxe-methods/plink2-workflow@sha256:4aee0db9cee2f494c82a2b0f05742f30785b13ef0e1257946928031f6f77059d /cromwell-executions/run_plink2/f4b3c5ff-a170-48ad-9beb-187e88d73914/call-process_phenos/execution/script

# get the return code (working even if the container was detached)
rc=$(docker wait `cat /Users/magdalenasevilla/plink2-workflow/cromwell-executions/run_plink2/f4b3c5ff-a170-48ad-9beb-187e88d73914/call-process_phenos/execution/docker_cid`)

# remove the container after waiting
docker rm `cat /Users/magdalenasevilla/plink2-workflow/cromwell-executions/run_plink2/f4b3c5ff-a170-48ad-9beb-187e88d73914/call-process_phenos/execution/docker_cid`

# return exit code
exit $rc
